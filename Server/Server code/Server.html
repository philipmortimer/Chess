<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<title>Server.java</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<style type="text/css">
<!--
body {color: #000000; background-color: #ffffff; font-family: Monospaced}
pre {color: #000000; background-color: #ffffff; font-family: Monospaced}
table {color: #000000; background-color: #e9e8e2; font-family: Monospaced}
.string {color: #ce7b00}
.literal {color: #0000e6}
.comment {color: #969696}
.ST0 {color: #969696; font-family: Monospaced; font-weight: bold}
-->
</style>
</head>
<body>
<table width="100%"><tr><td align="center">C:\Users\mortimer\OneDrive - gowercollegeswansea.ac.uk\Documents\College\YEAR 12\COMPUTER SCIENCE\Books attempt\DataBase\PhilipM CS5 Software Development Server System\src\philipm\cs5\software\development\server\system\Server.java</td></tr></table>
<pre>
  1 <span class="comment">/*</span>
  2 <span class="comment"> * To change this license header, choose License Headers in Project Properties.</span>
  3 <span class="comment"> * To change this template file, choose Tools | Templates</span>
  4 <span class="comment"> * and open the template in the editor.</span>
  5 <span class="comment"> */</span>
  6 <span class="literal">package</span> philipm.cs5.software.development.server.system;
  7 
  8 <span class="literal">import</span> java.io.BufferedReader;
  9 <span class="literal">import</span> java.io.BufferedWriter;
 10 <span class="literal">import</span> java.io.FileReader;
 11 <span class="literal">import</span> java.io.FileWriter;
 12 <span class="literal">import</span> java.io.IOException;
 13 <span class="literal">import</span> java.io.ObjectInputStream;
 14 <span class="literal">import</span> java.io.ObjectOutputStream;
 15 <span class="literal">import</span> java.net.ServerSocket;
 16 <span class="literal">import</span> java.net.Socket;
 17 <span class="literal">import</span> javax.swing.Timer;
 18 <span class="literal">import</span> philipm.cs5.software.development.user.system.InputPackages;
 19 
 20 <span class="comment">/**</span>
 21 <span class="comment"> * </span><span class="ST0">This</span> <span class="ST0">class</span> <span class="ST0">stores</span> <span class="ST0">the</span> <span class="ST0">server</span> <span class="ST0">that</span> <span class="ST0">enables</span> <span class="ST0">communication</span> <span class="ST0">with</span> <span class="ST0">any</span> <span class="ST0">number</span> <span class="ST0">of</span> <span class="ST0">clients</span><span class="ST0">.</span>
 22 <span class="comment"> * </span><span class="ST0">@author</span> <span class="comment">mortimer</span>
 23  <span class="comment">*/</span>
 24 <span class="comment">// class that performs server side commands. This class is a thread to allow for the serverUI form to be used whilst the server is active (hence it implements runnable)</span>
 25 <span class="literal">public</span> <span class="literal">class</span> Server <span class="literal">implements</span> Runnable{
 26     <span class="literal">public</span> <span class="literal">static</span> <span class="literal">final</span> String STARTING_BOARD_FEN=<span class="string">&quot;</span><span class="string">rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1</span><span class="string">&quot;</span>;<span class="comment">//stores the string that represents a new chess board</span>
 27     <span class="literal">private</span> <span class="literal">final</span> <span class="literal">int</span> PORT_NO;<span class="comment">//stores the port number for the server to map too</span>
 28     <span class="literal">public</span> String errorMessages[];<span class="comment">//stores all errors that have occured in an array. If the length of this array is not equal to zero, some form of error has occured.</span>
 29     <span class="literal">public</span> String[][]userFile;<span class="comment">//stores the user text file contents as an arry to speed up file access speed</span>
 30     <span class="literal">public</span> String[][]emailLinkFile;<span class="comment">///stores the email link file as an array to speed up file access speed</span>
 31     <span class="literal">public</span> String[][]onlineGames;<span class="comment">//stores online games</span>
 32     <span class="literal">public</span> <span class="literal">static</span> <span class="literal">final</span> String USER_FILE_NAME=<span class="string">&quot;</span><span class="string">userDetails.txt</span><span class="string">&quot;</span>;<span class="comment">//stores the file name of the user details text file</span>
 33     <span class="literal">public</span> <span class="literal">static</span> <span class="literal">final</span> String SPLIT_ITEM=UserInfo.SPLIT_ITEM;
 34     <span class="literal">public</span> <span class="literal">static</span> <span class="literal">final</span> String EMAIL_FILE_NAME=<span class="string">&quot;</span><span class="string">emailLinkFile.txt</span><span class="string">&quot;</span>;
 35     <span class="literal">public</span> <span class="literal">static</span> <span class="literal">final</span> <span class="literal">int</span> WIDTH_OF_ONLINE_FILE=14;<span class="comment">//stores the number of fields in a record in the online file: game code, opp1,opp2, FEN(s), time elapsed, time White, time Black, boolean hasPlayerOneSeenGameOver, hasPlayerTwoSeenGameOver, isPlayerOneWhite, gameState, drawPlayerOne?,drawPlayerTwo?</span>
 36     <span class="literal">public</span> <span class="literal">static</span> <span class="literal">final</span> String GUEST_ID=UserInfo.GUEST_ID;
 37     <span class="literal">public</span> <span class="literal">static</span> <span class="literal">final</span> String GUEST_EMAIL=UserInfo.GUEST_ID_EMAIL;
 38     <span class="literal">public</span> <span class="literal">static</span> <span class="literal">final</span> String GUEST_RECORD_USER_FILE=GUEST_ID+SPLIT_ITEM+SPLIT_ITEM+SPLIT_ITEM+SPLIT_ITEM+SPLIT_ITEM+SPLIT_ITEM+SPLIT_ITEM+SPLIT_ITEM+SPLIT_ITEM+SPLIT_ITEM+SPLIT_ITEM+SPLIT_ITEM+SPLIT_ITEM+SPLIT_ITEM+SPLIT_ITEM+SPLIT_ITEM;
 39     <span class="literal">private</span> ServerSocket serverSocket;
 40     <span class="literal">private</span> Timer timer;
 41     <span class="literal">public</span> <span class="literal">static</span> <span class="literal">final</span> String ONLINE_GAMES_FILE=<span class="string">&quot;</span><span class="string">onlineGames.txt</span><span class="string">&quot;</span>;<span class="comment">//stores the file name of the online games</span>
 42     <span class="literal">public</span> Queue queue;<span class="comment">//stores the queue used when writing to text files</span>
 43     <span class="literal">private</span> Thread queueThread;<span class="comment">//stores the thread which the queue uses</span>
 44     <span class="literal">public</span> <span class="literal">static</span> <span class="literal">final</span> String CLUB_CONTACT_PHONE_NUMBER_FILE=<span class="string">&quot;</span><span class="string">phoneNumber.txt</span><span class="string">&quot;</span>;
 45     <span class="literal">public</span> <span class="literal">static</span> <span class="literal">final</span> String CLUB_CONTACT_EMAIL_FILE=<span class="string">&quot;</span><span class="string">emailClubContact.txt</span><span class="string">&quot;</span>;
 46     <span class="literal">public</span> String[]clubContactDetails;<span class="comment">//stores the club&#39;s contact details</span>
 47     <span class="comment">/**</span>
 48 <span class="comment">     * </span><span class="ST0">Constructor</span> <span class="ST0">method</span> <span class="ST0">initialises</span> <span class="ST0">appropriate</span> <span class="ST0">constants</span> <span class="ST0">and</span> <span class="ST0">values</span><span class="ST0">.</span>
 49 <span class="comment">     * </span><span class="ST0">@param</span> <span class="comment">errorMessArray</span> <span class="comment">The</span> <span class="comment">array</span> <span class="comment">which</span> <span class="comment">stores</span> <span class="comment">the</span> <span class="comment">error</span> <span class="comment">messages</span><span class="comment">.</span> <span class="comment">This</span> <span class="comment">error</span> <span class="comment">should</span> <span class="comment">be</span> <span class="comment">of</span> <span class="comment">length</span> <span class="comment">zero</span> <span class="comment">but</span> <span class="comment">will</span> <span class="comment">be</span> <span class="comment">set</span> <span class="comment">to</span> <span class="comment">length</span> <span class="comment">zero</span> <span class="comment">regardless</span><span class="comment">.</span>
 50 <span class="comment">     * </span><span class="ST0">@throws</span> <span class="comment">Exception</span> <span class="comment">If</span> <span class="comment">an</span> <span class="comment">error</span> <span class="comment">occurred</span><span class="comment">, </span><span class="comment">an</span> <span class="comment">exception</span> <span class="comment">is</span> <span class="comment">throw</span><span class="comment">.</span> <span class="comment">This</span> <span class="comment">exception</span> <span class="comment">contains</span> <span class="comment">a</span> <span class="comment">String</span> <span class="comment">message</span> <span class="comment">that</span> <span class="comment">can</span> <span class="comment">be</span> <span class="comment">displayed</span><span class="comment">.</span>
 51      <span class="comment">*/</span>
 52     <span class="literal">public</span> Server(String[] errorMessArray ) <span class="literal">throws</span> Exception{
 53         errorMessArray=<span class="literal">new</span> String[0];
 54         errorMessages=errorMessArray;
 55         <span class="literal">try</span>{
 56             <span class="comment">//gets the port number for the server to run on</span>
 57             FileReader read = <span class="literal">new</span> FileReader(ChangeServerDetails.SERVER_SETTINGS_TEXT_FILE_NAME);
 58             BufferedReader buffRead = <span class="literal">new</span> BufferedReader(read);
 59             String portLine=buffRead.readLine();
 60             buffRead.close();read.close();
 61             <span class="literal">try</span>{
 62                 PORT_NO = Integer.parseInt(portLine);
 63             }<span class="literal">catch</span>(NumberFormatException ex){
 64                 <span class="literal">throw</span> <span class="literal">new</span> Exception(<span class="string">&quot;</span><span class="string">Port Number stored is not a valid integer. Please change the port number.</span><span class="string">&quot;</span>);
 65             }
 66         }<span class="literal">catch</span>(IOException e){
 67             <span class="literal">throw</span> <span class="literal">new</span> Exception(<span class="string">&quot;</span><span class="string">An error occured when attempting to retrieve the port number from the file </span><span class="string">&quot;</span>+ChangeServerDetails.SERVER_SETTINGS_TEXT_FILE_NAME+<span class="string">&quot;</span><span class="string"> Error details</span><span class="string">&quot;</span>+e);
 68         }
 69         <span class="comment">//loads text files into arrays for faster access</span>
 70         emailLinkFile=loadFileToArray(UserInfo.WIDTH_OF_EMAIL_LINK_FILE, EMAIL_FILE_NAME);
 71         userFile=loadFileToArray(UserInfo.WIDTH_OF_USER_DETAILS_FILE, USER_FILE_NAME);
 72         onlineGames=loadFileToArray(WIDTH_OF_ONLINE_FILE, ONLINE_GAMES_FILE);
 73         queue = <span class="literal">new</span> Queue(<span class="literal">this</span>);<span class="comment">//creates new queue</span>
 74         queueThread = <span class="literal">new</span> Thread(queue);queueThread.start();<span class="comment">//starts the thread for the queue</span>
 75         clubContactDetails=getClubContactDataFromFile();<span class="comment">//loads club contact details</span>
 76     }
 77     <span class="comment">/**</span>
 78 <span class="comment">     * </span><span class="ST0">Gets</span> <span class="ST0">the</span> <span class="ST0">club</span> <span class="ST0">contact</span> <span class="ST0">details</span> <span class="ST0">from</span> <span class="ST0">file</span>
 79 <span class="comment">     * </span><span class="ST0">@return</span> <span class="comment">The</span> <span class="comment">contact</span> <span class="comment">details</span>
 80      <span class="comment">*/</span>
 81     <span class="literal">private</span> String[] getClubContactDataFromFile(){
 82         String details[]=<span class="literal">new</span> String[2];details[0]=<span class="string">&quot;&quot;</span>;details[1]=<span class="string">&quot;&quot;</span>;
 83         <span class="literal">try</span>{
 84             FileReader readPhone = <span class="literal">new</span> FileReader(CLUB_CONTACT_PHONE_NUMBER_FILE);<span class="comment">//read the phone number from the file</span>
 85             BufferedReader buffReadPhone = <span class="literal">new</span> BufferedReader(readPhone);
 86             String fileCont=buffReadPhone.readLine();
 87             <span class="literal">if</span>(fileCont!=<span class="literal">null</span>){
 88                 details[0]=fileCont;
 89             }
 90             buffReadPhone.close();readPhone.close();
 91             FileReader readEmail = <span class="literal">new</span> FileReader(CLUB_CONTACT_EMAIL_FILE);<span class="comment">//read the email address from the file</span>
 92             BufferedReader buffReadEmail = <span class="literal">new</span> BufferedReader(readEmail);
 93             fileCont=buffReadEmail.readLine();
 94             <span class="literal">if</span>(fileCont!=<span class="literal">null</span>){
 95                 details[1]=fileCont;
 96             }
 97             buffReadEmail.close();readEmail.close();
 98         }<span class="literal">catch</span>(IOException e){
 99             System.out.println(<span class="string">&quot;</span><span class="string">Error with club contact files: </span><span class="string">&quot;</span>+e);
100         }
101         <span class="literal">return</span> details;
102         
103     }
104     <span class="comment">/**</span>
105 <span class="comment">     * </span><span class="ST0">This</span> <span class="ST0">method</span> <span class="ST0">is</span> <span class="ST0">used</span> <span class="ST0">to</span> <span class="ST0">add</span> <span class="ST0">the</span> <span class="ST0">guest</span> <span class="ST0">id</span> <span class="ST0">to</span> <span class="ST0">the</span> <span class="ST0">user</span> <span class="ST0">file</span><span class="ST0">.</span>
106 <span class="comment">     * </span><span class="comment">This</span> <span class="comment">method</span> <span class="comment">is</span> <span class="comment">no</span> <span class="comment">longer</span> <span class="comment">used</span> <span class="comment">as</span> <span class="comment">Guest</span> <span class="comment">records</span> <span class="comment">are</span> <span class="comment">not</span> <span class="comment">stored</span><span class="comment">.</span> <span class="comment">This</span> <span class="comment">has</span> <span class="comment">been</span> <span class="comment">kept</span> <span class="comment">to</span> <span class="comment">make</span> <span class="comment">the</span> <span class="comment">code</span> <span class="comment">maintainable</span> <span class="comment">and</span> <span class="comment">easy</span> <span class="comment">to</span> <span class="comment">expand</span><span class="comment">.</span>
107      <span class="comment">*/</span>
108     <span class="literal">private</span> <span class="literal">void</span> addGuestIdToFilesIfAppropriate(){
109         <span class="literal">try</span>{
110             <span class="comment">//checks to see if GuestId is already in user file</span>
111             FileReader r = <span class="literal">new</span> FileReader(USER_FILE_NAME);
112             BufferedReader buffUser = <span class="literal">new</span> BufferedReader(r);
113             String line=buffUser.readLine();
114             buffUser.close();r.close();
115             <span class="literal">if</span>(line==<span class="literal">null</span>){<span class="comment">//this will be true if the file is empty (i.e. no guest)</span>
116                 FileWriter write = <span class="literal">new</span> FileWriter(USER_FILE_NAME,<span class="literal">false</span>);
117                 BufferedWriter buffWrite = <span class="literal">new</span> BufferedWriter(write);
118                 buffWrite.write(GUEST_RECORD_USER_FILE);<span class="comment">//adds guest user file record to file</span>
119                 buffWrite.flush();write.flush();buffWrite.close();write.close();
120             }
121             <span class="comment">//checks to see if GuestId is alraedy in email file</span>
122             FileReader rEmail = <span class="literal">new</span> FileReader(EMAIL_FILE_NAME);
123             BufferedReader buffEmail = <span class="literal">new</span> BufferedReader(rEmail);
124             line = buffEmail.readLine();
125             buffEmail.close();rEmail.close();
126             <span class="literal">if</span>(line==<span class="literal">null</span>){<span class="comment">//this will be true if the file is empty (i.e. no guest)</span>
127                 FileWriter write = <span class="literal">new</span> FileWriter(EMAIL_FILE_NAME,<span class="literal">false</span>);
128                 BufferedWriter buffWrite = <span class="literal">new</span> BufferedWriter(write);
129                 buffWrite.write(GUEST_EMAIL+SPLIT_ITEM+GUEST_ID);<span class="comment">//adds guest user file record to file</span>
130                 buffWrite.flush();write.flush();buffWrite.close();write.close();
131             }
132         }<span class="literal">catch</span>(IOException e){
133             addErrorToErrorMessages(<span class="string">&quot;</span><span class="string">An error occurred when adding guest details: </span><span class="string">&quot;</span>+e.getMessage());
134         }
135     }
136     <span class="comment">/**</span>
137 <span class="comment">     * </span><span class="ST0">Reads</span> <span class="ST0">a</span> <span class="ST0">text</span> <span class="ST0">file</span> <span class="ST0">and</span> <span class="ST0">converts</span> <span class="ST0">into</span> <span class="ST0">a</span><span class="ST0"> 2</span><span class="ST0">d</span> <span class="ST0">array</span><span class="ST0">.</span>
138 <span class="comment">     * </span><span class="ST0">@param</span> <span class="comment">widthOfFile</span> <span class="comment">The</span> <span class="comment">number</span> <span class="comment">of</span> <span class="comment">fields</span> <span class="comment">in</span> <span class="comment">the</span> <span class="comment">file</span>
139 <span class="comment">     * </span><span class="ST0">@param</span> <span class="comment">fileName</span> <span class="comment">The</span> <span class="comment">fileName</span>
140 <span class="comment">     * </span><span class="ST0">@return</span> <span class="comment">The</span> <span class="comment">array</span> <span class="comment">that</span> <span class="comment">represents</span> <span class="comment">the</span> <span class="comment">data</span> <span class="comment">stored</span> <span class="comment">in</span> <span class="comment">the</span> <span class="comment">file</span>
141      <span class="comment">*/</span>
142     <span class="literal">private</span> String[][]loadFileToArray(<span class="literal">int</span> widthOfFile,String fileName){
143         <span class="literal">try</span>{
144             FileReader read = <span class="literal">new</span> FileReader(fileName);
145             BufferedReader buffRead = <span class="literal">new</span> BufferedReader(read);
146             <span class="literal">int</span> length =0;
147             <span class="literal">while</span>(buffRead.readLine()!=<span class="literal">null</span>){<span class="comment">//caclaulates number of records in file</span>
148                 length++;
149             }
150             buffRead.close();read.close();
151             String newFile[][]=<span class="literal">new</span> String[length][widthOfFile];
152             <span class="literal">for</span>(<span class="literal">int</span> i=0;i&lt;newFile.length;i++){
153                 <span class="literal">for</span>(<span class="literal">int</span> j=0;j&lt;widthOfFile;j++){
154                     newFile[i][j]=<span class="string">&quot;&quot;</span>;<span class="comment">//intialises all values to &quot;&quot; to avoid problems that can arise with null values</span>
155                 }
156             }
157             FileReader readTwo = <span class="literal">new</span> FileReader(fileName);
158             BufferedReader buffTwo = <span class="literal">new</span> BufferedReader(readTwo);
159             String line;<span class="literal">int</span> i=0;
160             String[]lineArr;
161             <span class="comment">//loads text file to array</span>
162             <span class="literal">while</span>((line=buffTwo.readLine())!=<span class="literal">null</span>){
163                 lineArr=line.split(SPLIT_ITEM);
164                 <span class="literal">for</span>(<span class="literal">int</span> j=0;j&lt;lineArr.length;j++){
165                     newFile[i][j]=lineArr[j];
166                     <span class="literal">if</span>(lineArr[j]==<span class="literal">null</span>){
167                         newFile[i][j]=<span class="string">&quot;&quot;</span>;
168                     }
169                 }
170                 i++;
171             }buffTwo.close();readTwo.close();
172             <span class="literal">return</span> newFile;
173         }<span class="literal">catch</span>(IOException e){
174             addErrorToErrorMessages(<span class="string">&quot;</span><span class="string">An error occured when accessing </span><span class="string">&quot;</span>+fileName+<span class="string">&quot;</span><span class="string"> Error: </span><span class="string">&quot;</span>+e.getMessage());<span class="comment">//adds error to display</span>
175         }
176         <span class="literal">return</span> <span class="literal">new</span> String[0][0];
177     }
178     <span class="comment">/**</span>
179 <span class="comment">     * </span><span class="ST0">This</span> <span class="ST0">thread</span> <span class="ST0">runs</span> <span class="ST0">and</span> <span class="ST0">creates</span> <span class="ST0">a</span> <span class="ST0">new</span> <span class="ST0">thread</span> <span class="ST0">for</span> <span class="ST0">every</span> <span class="ST0">client</span> <span class="ST0">communication</span><span class="ST0">.</span> <span class="comment">This</span> <span class="comment">allows</span> <span class="comment">for</span> <span class="comment">any</span> <span class="comment">number</span> <span class="comment">of</span> <span class="comment">clients</span> <span class="comment">to</span> <span class="comment">communicate</span> <span class="comment">with</span> <span class="comment">the</span> <span class="comment">server</span>
180 <span class="comment">     * </span><span class="comment">simultaneously</span><span class="comment">.</span>
181      <span class="comment">*/</span>
182     @Override
183     <span class="literal">public</span> <span class="literal">void</span> run() {
184         <span class="literal">try</span>{
185             serverSocket = <span class="literal">new</span> ServerSocket(PORT_NO);<span class="comment">//creates the server</span>
186             <span class="literal">while</span>(<span class="literal">true</span>){<span class="comment">//continuosly checks for new connections</span>
187                 Socket clientSocket = serverSocket.accept();<span class="comment">//accepts nay client communications</span>
188                 <span class="comment">//creates a new thread that reads the client input and performs an approriate action accoridngly. This involves read and write objects.</span>
189                 Thread thread = <span class="literal">new</span> Thread(){
190                     @Override
191                     <span class="literal">public</span> <span class="literal">void</span> run(){
192                         InputPackages message=<span class="literal">null</span>;
193                         <span class="literal">try</span>{
194                             ObjectOutputStream objOut = <span class="literal">new</span> ObjectOutputStream(clientSocket.getOutputStream());<span class="comment">//gets the output stream incase a value needs to be returned to the client</span>
195                             ObjectInputStream objIn = <span class="literal">new</span> ObjectInputStream(clientSocket.getInputStream()); <span class="comment">//gets the input of client</span>
196                             <span class="literal">try</span> {
197                                 message=(InputPackages)objIn.readObject();<span class="comment">//gets the InputPackage</span>
198                                 String command = message.getActionName();
199                                 <span class="comment">//checks to see the client message and perform various actions depending on the contents</span>
200                                 <span class="literal">switch</span> (command) {
201                                     <span class="literal">case</span> InputPackages.GET_USER_INFO_WITH_USERNAME_AND_PASSWORD:
202                                         {
203                                             UserInfo ret =queue.getUserDetailsAndTryLogInWithUsername(message.getPackageToSend()[1],message.getPackageToSend()[2]);
204                                             objOut.writeObject(ret);
205                                             <span class="literal">break</span>;
206                                         }
207                                     <span class="literal">case</span> InputPackages.GET_USER_INFO_WITH_EMAIL_AND_PASSWORD:
208                                         {
209                                             UserInfo ret = queue.getEmailAddressAndTryLogIn(message.getPackageToSend()[1],message.getPackageToSend()[2]);
210                                             objOut.writeObject(ret);
211                                             <span class="literal">break</span>;
212                                         }
213                                     <span class="literal">case</span> InputPackages.CREATE_ACCOUNT:
214                                         queue.addInputPackageTask(message);
215                                         <span class="literal">break</span>;
216                                     <span class="literal">case</span> InputPackages.GET_ONLINE_GAMES_FOR_USER:
217                                         objOut.writeObject(queue.getAllGamesWithUser(message.getPackageToSend()[1]));<span class="comment">//returns all online games with user</span>
218                                         <span class="literal">break</span>;
219                                     <span class="literal">case</span> InputPackages.CREATE_RANDOM_GAME:
220                                         queue.addInputPackageTask(message);
221                                         <span class="literal">break</span>;
222                                     <span class="literal">case</span> InputPackages.DELETE_GAME:
223                                         queue.addInputPackageTask(message);
224                                         <span class="literal">break</span>;
225                                     <span class="literal">case</span> InputPackages.CREATE_NEW_GAME_AGAINST_FRIEND:
226                                         objOut.writeObject(queue.createOnlineGameAgainstFriend(message.getPackageToSend()[1], message.getPackageToSend()[2], message.getPackageToSend()[3]));
227                                         <span class="literal">break</span>;
228                                     <span class="literal">case</span> InputPackages.JOIN_GAME_USING_GAME_CODE:
229                                         objOut.writeObject(queue.joinGameUsingFriendCode(message.getPackageToSend()[2],Integer.parseInt(message.getPackageToSend()[1])));
230                                         <span class="literal">break</span>;
231                                     <span class="literal">case</span> InputPackages.GET_GAME_RECORD:
232                                         objOut.writeObject(queue.getGameRecord(Integer.parseInt(message.getPackageToSend()[1])));
233                                         <span class="literal">break</span>;
234                                     <span class="literal">case</span> InputPackages.UPDATED_ONLINE_GAME_RECORD:
235                                         queue.addInputPackageTask(message);
236                                         <span class="literal">break</span>;
237                                     <span class="literal">case</span> InputPackages.GET_CLUB_CONTACT_DETAILS:
238                                         objOut.writeObject(queue.getClubContactInfo());
239                                         <span class="literal">break</span>;
240                                     <span class="literal">case</span> InputPackages.GET_WHETHER_USER_HAS_REQUESTED_TO_JOIN_CLUB:
241                                         objOut.writeBoolean(queue.hasUserRequestedToJoinClub(message.getPackageToSend()[1]));
242                                         <span class="literal">break</span>;
243                                     <span class="literal">case</span> InputPackages.CHANGE_STATUS_REQUEST_TO_JOIN_CLUB:
244                                         queue.addInputPackageTask(message);
245                                         <span class="literal">break</span>;
246                                     <span class="literal">case</span> InputPackages.REMOVE_USER_FROM_CHESS_CLUB:
247                                         queue.addInputPackageTask(message);
248                                         <span class="literal">break</span>;
249                                     <span class="literal">case</span> InputPackages.GET_LEAGUE_TABLE:
250                                         objOut.writeObject(queue.getLeagueTable());
251                                         <span class="literal">break</span>;
252                                     <span class="literal">case</span> InputPackages.GET_ALL_CLUB_MEMBERS:
253                                         objOut.writeObject(queue.getAllClubMembers());
254                                         <span class="literal">break</span>;
255                                     <span class="literal">case</span> InputPackages.GET_FIXTURES_AND_RESULTS:
256                                         objOut.writeObject(queue.getAllFixturesAndResults());
257                                         <span class="literal">break</span>;
258                                     <span class="literal">case</span> InputPackages.GET_PEOPLE_ADDED_MIDWAY_THROUGH_SEASON:
259                                         objOut.writeObject(queue.getPeopleAddedMidwayThroughSeason());
260                                         <span class="literal">break</span>;
261                                     <span class="literal">case</span> InputPackages.UPDATED_FIXTURES_AND_RESULTS:
262                                         queue.addInputPackageTask(message);
263                                         <span class="literal">break</span>;
264                                     <span class="literal">case</span> InputPackages.CREATE_NEW_SEASON:
265                                         queue.addInputPackageTask(message);
266                                         <span class="literal">break</span>;
267                                     <span class="literal">case</span> InputPackages.SET_CONTACT_DETAILS:
268                                         queue.addInputPackageTask(message);
269                                         <span class="literal">break</span>;
270                                     <span class="literal">case</span> InputPackages.SET_USER_AS_LEADER:
271                                         <span class="literal">try</span>{
272                                             queue.setUserAsLeaderAndMember(message.getPackageToSend()[1]);
273                                         }<span class="literal">catch</span>(Exception e){
274                                             System.out.println(<span class="string">&quot;</span><span class="string">Error with setting new leader: </span><span class="string">&quot;</span>+e);
275                                         }   <span class="literal">break</span>;
276                                     <span class="literal">case</span> InputPackages.GET_ALL_REQUESTS:
277                                         objOut.writeObject(queue.getAllRequestsToJoinClub());
278                                         <span class="literal">break</span>;
279                                     <span class="literal">case</span> InputPackages.GET_EMAIL_OF_USER:
280                                         objOut.writeObject(queue.getEmailOfUser(message.getPackageToSend()[1]));
281                                         <span class="literal">break</span>;
282                                     <span class="literal">case</span> InputPackages.REMOVE_REQUEST_JOIN_CLUB:
283                                         queue.addInputPackageTask(message);
284                                         <span class="literal">break</span>;
285                                     <span class="literal">case</span> InputPackages.ADD_USER_TO_CLUB:
286                                         queue.addInputPackageTask(message);
287                                         <span class="literal">break</span>;
288                                     <span class="literal">case</span> InputPackages.GET_CLUB_MEMBER_DETAILS_ALL_MEMBERS:
289                                         objOut.writeObject(queue.getAllClubMemberDetails());
290                                         <span class="literal">break</span>;
291                                     <span class="literal">case</span> InputPackages.UPDATE_USER_INFO_FILE_RECORD:
292                                         queue.addInputPackageTask(message);
293                                         <span class="literal">break</span>;
294                                     <span class="literal">case</span> InputPackages.REMOVE_NON_MEMBER_USER:
295                                         queue.addInputPackageTask(message);
296                                         <span class="literal">break</span>;
297                                     <span class="literal">case</span> InputPackages.GET_ALL_NON_MEMBERS:
298                                         objOut.writeObject(queue.getAllNonMemberDetails());
299                                         <span class="literal">break</span>;
300                                     <span class="literal">default</span>:
301                                         <span class="literal">break</span>;
302                                 }
303                             } <span class="literal">catch</span> (ClassNotFoundException ex) {
304                                 addErrorToErrorMessages(<span class="string">&quot;</span><span class="string">There has been an ClassNotFoundException with the server, specifically the object stream. Error details: </span><span class="string">&quot;</span>+ex);
305                                 objOut.flush();objOut.close();objIn.close();
306                                 <span class="literal">return</span>;
307                             }
308                             objOut.flush();objOut.close();<span class="comment">//closes and flushes approriate streams before terminating the thread</span>
309                             objIn.close();
310                         }<span class="literal">catch</span>(IOException e){
311                             System.out.println(<span class="string">&quot;</span><span class="string">Error that may not be fatal: </span><span class="string">&quot;</span>+e);
312                             <span class="literal">try</span>{
313                                 System.out.println(message.getActionName());
314                             }<span class="literal">catch</span>(Exception ez){
315                                 System.out.println(ez);
316                             } 
317                             <span class="comment">//addErrorToErrorMessages(&quot;There has been an IOException with the server, specifically the object stream. Error details: &quot;+e);</span>
318                             <span class="literal">return</span>;
319                         }
320                     }
321                 };
322                 thread.start(); <span class="comment">//starts the thread</span>
323             }
324         }<span class="literal">catch</span>(IOException e){
325             addErrorToErrorMessages(<span class="string">&quot;</span><span class="string">There has been an IOException with the server. Error details: </span><span class="string">&quot;</span>+e);
326             <span class="literal">return</span>;
327         }
328     }
329     <span class="comment">/**</span>
330 <span class="comment">     * </span><span class="ST0">Writes</span> <span class="ST0">the</span> <span class="ST0">array</span> <span class="ST0">to</span> <span class="ST0">the</span> <span class="ST0">specified</span> <span class="ST0">text</span> <span class="ST0">file</span><span class="ST0">, </span><span class="ST0">with</span> <span class="ST0">each</span> <span class="ST0">field</span> <span class="ST0">being</span> <span class="ST0">split</span> <span class="ST0">with</span> <span class="ST0">an</span> <span class="ST0">appropriate</span> <span class="ST0">character</span><span class="ST0">.</span>
331 <span class="comment">     * </span><span class="ST0">@param</span> <span class="comment">array</span> <span class="comment">The</span><span class="comment"> 2</span><span class="comment">d</span> <span class="comment">string</span> <span class="comment">array</span>
332 <span class="comment">     * </span><span class="ST0">@param</span> <span class="comment">fileName</span> <span class="comment">The</span> <span class="comment">file</span> <span class="comment">name</span>
333      <span class="comment">*/</span>
334     <span class="literal">public</span> <span class="literal">void</span> writeArrayToFileWithSplit(String[][]array,String fileName){
335         <span class="literal">try</span>{
336             FileWriter write = <span class="literal">new</span> FileWriter(fileName,<span class="literal">false</span>);
337             BufferedWriter buffWrite = <span class="literal">new</span> BufferedWriter(write);
338             String line;
339             <span class="literal">for</span>(<span class="literal">int</span> y=0;y&lt;array.length;y++){<span class="comment">//loops through every line in the array and seperates each filed with a seperation character</span>
340                 line=<span class="string">&quot;&quot;</span>;
341                 <span class="literal">for</span>(<span class="literal">int</span> x=0;x&lt;array[0].length;x++){
342                     <span class="literal">if</span>(x==0){
343                         <span class="literal">if</span>(array[y][x]!=<span class="literal">null</span>){<span class="comment">//null values are not written to the file</span>
344                             line =array[y][x];
345                         }
346                     }<span class="literal">else</span>{
347                         <span class="literal">if</span>(array[y][x]!=<span class="literal">null</span>){
348                             line = line +SPLIT_ITEM+array[y][x];
349                         }<span class="literal">else</span>{
350                             line = line +SPLIT_ITEM;
351                         }
352                     }
353                 }
354                 <span class="comment">//the appropriate line of text is written to the file</span>
355                 <span class="literal">if</span>(y!=0){
356                     buffWrite.newLine();
357                 }
358                 buffWrite.write(line);
359             }
360             <span class="comment">//closes and flushes writers</span>
361             buffWrite.flush();write.flush();
362             buffWrite.close();write.close();
363         }<span class="literal">catch</span>(IOException e){
364             addErrorToErrorMessages(<span class="string">&quot;</span><span class="string">Exception when writing to file </span><span class="string">&quot;</span>+fileName+<span class="string">&quot;</span><span class="string"> Error </span><span class="string">&quot;</span>+e.getMessage());
365         }
366     }
367     <span class="comment">/**</span>
368 <span class="comment">     * </span><span class="ST0">Closes</span> <span class="ST0">the</span> <span class="ST0">server</span> <span class="ST0">socket</span> <span class="ST0">and</span> <span class="ST0">stops</span> <span class="ST0">the</span> <span class="ST0">thread</span>
369 <span class="comment">     * </span><span class="ST0">@throws</span> <span class="comment">IOException</span> <span class="comment">An</span> <span class="comment">IOException</span> <span class="comment">may</span> <span class="comment">occur</span>
370      <span class="comment">*/</span>
371     <span class="literal">public</span> <span class="literal">void</span> closeServerSocket() <span class="literal">throws</span> IOException{
372         queue.stopThread();
373         serverSocket.close();
374     }
375     <span class="comment">/**</span>
376 <span class="comment">     * </span><span class="ST0">Checks</span> <span class="ST0">to</span> <span class="ST0">see</span> <span class="ST0">if</span> <span class="ST0">any</span> <span class="ST0">error</span> <span class="ST0">have</span> <span class="ST0">occurred</span> <span class="ST0">in</span> <span class="ST0">the</span> <span class="ST0">program</span>
377 <span class="comment">     * </span><span class="ST0">@return</span> <span class="comment">True</span> <span class="comment">is</span> <span class="comment">returned</span> <span class="comment">if</span> <span class="comment">the</span> <span class="comment">error</span> <span class="comment">messages</span> <span class="comment">array</span> <span class="comment">length</span> <span class="comment">is</span> <span class="comment">not</span> <span class="comment">equal</span> <span class="comment">to</span> <span class="comment">one</span><span class="comment">.</span> <span class="comment">Otherwise</span> <span class="comment">false</span> <span class="comment">is</span> <span class="comment">returned</span> 
378      <span class="comment">*/</span>
379     <span class="literal">public</span> <span class="literal">boolean</span> haveAnyErrorsOccured(){
380         <span class="literal">return</span> errorMessages.length!=0;
381     }
382     <span class="comment">/**</span>
383 <span class="comment">     * </span><span class="ST0">Gets</span> <span class="ST0">all</span> <span class="ST0">error</span> <span class="ST0">messages</span><span class="ST0">.</span>
384 <span class="comment">     * </span><span class="ST0">@return</span> <span class="comment">The</span> <span class="comment">error</span> <span class="comment">message</span><span class="comment">.</span> <span class="comment">Each</span> <span class="comment">element</span> <span class="comment">in</span> <span class="comment">the</span> <span class="comment">array</span> <span class="comment">represents</span> <span class="comment">an</span> <span class="comment">error</span> <span class="comment">message</span><span class="comment">.</span>
385      <span class="comment">*/</span>
386     <span class="literal">public</span> String[]getErrorMessages(){
387         <span class="literal">return</span> errorMessages;
388     }
389     <span class="comment">/**</span>
390 <span class="comment">     * </span><span class="ST0">Adds</span> <span class="ST0">a</span> <span class="ST0">new</span> <span class="ST0">error</span> <span class="ST0">message</span> <span class="ST0">to</span> <span class="ST0">the</span> <span class="ST0">array</span> <span class="ST0">that</span> <span class="ST0">stores</span> <span class="ST0">all</span> <span class="ST0">error</span> <span class="ST0">messages</span><span class="ST0">.</span> <span class="comment">Also</span> <span class="comment">sets</span> <span class="comment">the</span> <span class="comment">variable</span> <span class="comment">hasErrorOccuredToTrue</span>
391 <span class="comment">     * </span><span class="ST0">@param</span> <span class="comment">newError</span> <span class="comment">the</span> <span class="comment">new</span> <span class="comment">error</span> <span class="comment">message</span> <span class="comment">to</span> <span class="comment">be</span> <span class="comment">appended</span>
392      <span class="comment">*/</span>
393     <span class="literal">private</span> <span class="literal">void</span> addErrorToErrorMessages(String newError){
394         String updatedArray[] = <span class="literal">new</span> String[errorMessages.length+1];
395         <span class="literal">for</span>(<span class="literal">int</span> i=0;i&lt;errorMessages.length;i++){
396             updatedArray[i]=errorMessages[i];
397         }
398         updatedArray[errorMessages.length]=newError;
399         errorMessages=updatedArray;
400     }
401 }
402 
</pre></body>
</html>
